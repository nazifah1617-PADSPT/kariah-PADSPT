<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Data Masjid Parlimen Permatang Pauh</title>
    
    <!-- Tailwind CSS untuk Styling Pantas & Profesional -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome untuk Ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts: Inter (Font moden dan jelas) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .header-bg {
            background: linear-gradient(90deg, #1e3a8a 0%, #172554 100%);
        }
        .gold-line {
            height: 4px;
            background: #fbbf24;
        }
        /* Custom File Input Styling */
        .file-upload-wrapper {
            position: relative;
            width: 100%;
            height: 50px;
            border: 2px dashed #cbd5e1;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8fafc;
            transition: all 0.3s;
            cursor: pointer;
        }
        .file-upload-wrapper:hover {
            border-color: #1e40af;
            background-color: #eff6ff;
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3498db;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen text-gray-800">

    <!-- Navbar / Header Rasmi -->
    <header class="header-bg text-white shadow-lg">
        <div class="gold-line"></div>
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <!-- Logo -->
                <img src="https://i.postimg.cc/HsVZqzF5/JATAPenang.png" alt="Logo Rasmi" class="h-16 w-auto bg-white rounded-lg p-1 shadow-md object-contain">
                
                <div>
                    <h1 class="text-sm md:text-lg font-bold uppercase tracking-wide">Pejabat Agama Daerah</h1>
                    <h2 class="text-xs md:text-sm font-light text-blue-200">Seberang Perai Tengah</h2>
                </div>
            </div>
            <div class="hidden md:block">
                <span class="text-xs bg-blue-800 px-3 py-1 rounded border border-blue-600">Portal Pengurusan Data</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 md:py-12">
        <div class="max-w-3xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden border border-gray-200">
            
            <!-- Form Header -->
            <div class="bg-gray-50 px-6 py-5 border-b border-gray-200 flex items-center justify-between">
                <h3 class="text-xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-mosque text-blue-900 mr-3"></i>
                    Borang Data Maklumat Masjid
                </h3>
                <span class="text-xs font-semibold text-gray-500 bg-gray-200 px-2 py-1 rounded">Sulit & Rasmi</span>
            </div>

            <!-- Form Content -->
            <div class="p-6 md:p-8">
                <p class="mb-6 text-sm text-gray-600 bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                    <i class="fas fa-info-circle mr-2"></i>
                    Sila lengkapkan maklumat di bawah dengan teliti. Pastikan salinan akaun bank dimuat naik dalam format gambar atau PDF untuk tujuan bantuan kepada masjid terpilih.
                </p>

                <form id="masjidForm" class="space-y-6">
                    
                    <!-- Nama Masjid Dropdown -->
                    <div>
                        <label for="namaMasjid" class="block text-sm font-semibold text-gray-700 mb-2">Nama Masjid</label>
                        <div class="relative">
                            <select id="namaMasjid" name="namaMasjid" required
                                class="block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md border shadow-sm appearance-none bg-white text-gray-900">
                                <option value="" disabled selected>-- Sila Pilih Masjid --</option>
                                <option value="Masjid Pengkalan Tambang">Masjid Pengkalan Tambang</option>
                                <option value="Masjid Bukit Indera Muda">Masjid Bukit Indera Muda</option>
                                <option value="Masjid Permatang Nibong">Masjid Permatang Nibong</option>
                                <option value="Masjid Haji Saad">Masjid Haji Saad</option>
                                <option value="Masjid Permatang Batu">Masjid Permatang Batu</option>
                                <option value="Masjid Kampung Pelet">Masjid Kampung Pelet</option>
                                <option value="Masjid Kuala Mengkuang">Masjid Kuala Mengkuang</option>
                                <option value="Masjid Mengkuang Semarak">Masjid Mengkuang Semarak</option>
                                <option value="Masjid Sama Gagah">Masjid Sama Gagah</option>
                                <option value="Masjid Kubang Ulu">Masjid Kubang Ulu</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                <i class="fas fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Nama Pengerusi -->
                    <div>
                        <label for="namaPengerusi" class="block text-sm font-semibold text-gray-700 mb-2">Nama Pengerusi</label>
                        <div class="relative rounded-md shadow-sm">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-user text-gray-400"></i>
                            </div>
                            <input type="text" name="namaPengerusi" id="namaPengerusi" required
                                class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md py-3 border"
                                placeholder="Cth: Hj. Ahmad bin Albab">
                        </div>
                    </div>

                    <!-- Nombor Telefon -->
                    <div>
                        <label for="noTelefon" class="block text-sm font-semibold text-gray-700 mb-2">Nombor Telefon</label>
                        <div class="relative rounded-md shadow-sm">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-phone text-gray-400"></i>
                            </div>
                            <input type="tel" name="noTelefon" id="noTelefon" required
                                class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md py-3 border"
                                placeholder="Cth: 012-3456789">
                        </div>
                    </div>

                    <!-- Grid Layout for Account Details -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Nombor Akaun -->
                        <div>
                            <label for="noAkaun" class="block text-sm font-semibold text-gray-700 mb-2">Nombor Akaun Masjid</label>
                            <div class="relative rounded-md shadow-sm">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-credit-card text-gray-400"></i>
                                </div>
                                <input type="number" name="noAkaun" id="noAkaun" required
                                    class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md py-3 border"
                                    placeholder="Cth: 1234567890">
                            </div>
                        </div>

                        <!-- Muat Naik Salinan -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Salinan Penyata Akaun Masjid</label>
                            <div class="file-upload-wrapper" onclick="document.getElementById('fileAkaun').click()">
                                <span id="fileName" class="text-sm text-gray-500 select-none">
                                    <i class="fas fa-cloud-upload-alt mr-2 text-blue-600"></i> Klik untuk muat naik
                                </span>
                                <input type="file" id="fileAkaun" name="fileAkaun" class="hidden" accept="image/*,.pdf" onchange="updateFileName(this, 'fileName')">
                            </div>
                            <p class="mt-1 text-xs text-gray-400 text-right">Format: JPG, PNG, PDF (Max 5MB)</p>
                        </div>
                    </div>

                    <!-- BAHAGIAN BARU: MAKLUMAT SURAU -->
                    <div class="pt-8 mt-4 border-t-2 border-dashed border-gray-200">
                        <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                            <i class="fas fa-moon text-blue-900 mr-2"></i> Maklumat Surau (Pencalonan)
                        </h4>
                        
                        <!-- Arahan Khas -->
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded-r">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-exclamation-circle text-yellow-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-yellow-700 font-medium">
                                        Sila calonkan nama surau dan nombor akaun surau berkenaan di bawah kariah tuan untuk tujuan bantuan.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <!-- Nama Surau -->
                            <div>
                                <label for="namaSurau" class="block text-sm font-semibold text-gray-700 mb-2">Nama Surau</label>
                                <div class="relative rounded-md shadow-sm">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-place-of-worship text-gray-400"></i>
                                    </div>
                                    <input type="text" name="namaSurau" id="namaSurau"
                                        class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md py-3 border"
                                        placeholder="Cth: Surau Al-Hidayah, Taman Pauh">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Nombor Akaun Surau -->
                                <div>
                                    <label for="noAkaunSurau" class="block text-sm font-semibold text-gray-700 mb-2">Nombor Akaun Surau</label>
                                    <div class="relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-credit-card text-gray-400"></i>
                                        </div>
                                        <input type="number" name="noAkaunSurau" id="noAkaunSurau"
                                            class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md py-3 border"
                                            placeholder="Cth: 1234567890">
                                    </div>
                                </div>

                                <!-- Muat Naik Salinan Surau -->
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Salinan Akaun Surau</label>
                                    <div class="file-upload-wrapper" onclick="document.getElementById('fileAkaunSurau').click()">
                                        <span id="fileNameSurau" class="text-sm text-gray-500 select-none">
                                            <i class="fas fa-cloud-upload-alt mr-2 text-blue-600"></i> Klik untuk muat naik
                                        </span>
                                        <input type="file" id="fileAkaunSurau" name="fileAkaunSurau" class="hidden" accept="image/*,.pdf" onchange="updateFileName(this, 'fileNameSurau')">
                                    </div>
                                    <p class="mt-1 text-xs text-gray-400 text-right">Format: JPG, PNG, PDF (Max 5MB)</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-4">
                        <button type="submit" id="btnHantar"
                            class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-900 hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-900 transition-colors duration-200">
                            <span id="btnText">HANTAR DATA</span>
                            <div id="loadingSpinner" class="loader ml-3"></div>
                        </button>
                    </div>

                </form>
            </div>
            
            <!-- Footer Form -->
            <div class="bg-gray-50 px-6 py-4 border-t border-gray-200 text-center">
                <p class="text-xs text-gray-500">&copy; 2025 Pejabat Agama Daerah Seberang Perai Tengah. Hak Cipta Terpelihara.</p>
            </div>
        </div>
    </main>

    <!-- Success Notification Modal -->
    <div id="successModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50 flex items-center justify-center">
        <div class="relative p-5 border w-96 shadow-lg rounded-md bg-white text-center transform transition-all scale-100">
            <div class="mt-3">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                    <i class="fas fa-check text-green-600 text-xl"></i>
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900">Berjaya Dihantar!</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500">
                        Terima kasih. Data masjid telah direkodkan ke dalam pangkalan data kami.
                    </p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="okBtn" class="px-4 py-2 bg-blue-900 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Kemaskini nama fail bila pengguna memilih fail (Updated for generic use)
        function updateFileName(input, spanId) {
            const fileNameSpan = document.getElementById(spanId);
            if (input.files && input.files.length > 0) {
                fileNameSpan.innerHTML = `<i class="fas fa-file-alt mr-2 text-green-600"></i> ${input.files[0].name}`;
                fileNameSpan.classList.add("text-gray-800");
                fileNameSpan.classList.remove("text-gray-500");
            } else {
                fileNameSpan.innerHTML = `<i class="fas fa-cloud-upload-alt mr-2 text-blue-600"></i> Klik untuk muat naik`;
                fileNameSpan.classList.remove("text-gray-800");
                fileNameSpan.classList.add("text-gray-500");
            }
        }

        // Helper: Convert File to Base64 (Supaya boleh hantar ke Google Script)
        const fileToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    resolve({
                        data: reader.result.split(',')[1], // Ambil data base64 sahaja
                        name: file.name,
                        mimeType: file.type
                    });
                };
                reader.onerror = error => reject(error);
            });
        };

        // Handle Form Submission
        const form = document.getElementById('masjidForm');
        const modal = document.getElementById('successModal');
        const okBtn = document.getElementById('okBtn');
        const btnHantar = document.getElementById('btnHantar');
        const btnText = document.getElementById('btnText');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // PENTING: Masukkan URL Web App anda di sini (Dari Langkah 4)
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbykuihsOwwCCwM2-nYizAhWwVQYuKmZvxn2AQnmUpZTJ5RyLPGKBJMqDkBm2tygSaq1/exec'; 

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // 1. UI Loading State
            btnHantar.disabled = true;
            btnHantar.classList.add('opacity-75', 'cursor-not-allowed');
            btnText.innerText = "SEDANG MENGHANTAR...";
            loadingSpinner.style.display = "block";

            try {
                // 2. Kumpul Data
                const formData = new FormData(form);
                const dataObject = Object.fromEntries(formData.entries());

                // 3. Proses Fail (Jika ada)
                const fileInputMasjid = document.getElementById('fileAkaun');
                if (fileInputMasjid.files.length > 0) {
                    dataObject.fileAkaun = await fileToBase64(fileInputMasjid.files[0]);
                }

                const fileInputSurau = document.getElementById('fileAkaunSurau');
                if (fileInputSurau.files.length > 0) {
                    dataObject.fileAkaunSurau = await fileToBase64(fileInputSurau.files[0]);
                }

                // 4. Hantar ke Google Apps Script
                // Kita guna 'no-cors' mode untuk elak isu browser, tapi kita tak boleh baca response text secara direct.
                // Namun, untuk form mudah, 'POST' standard selalunya cukup jika Apps Script set CORS headers (macam dalam kod di atas).
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(dataObject)
                });
                
                // Nota: Google Apps Script Web App kadang-kadang return opaque response, 
                // jadi kita anggap berjaya jika tiada error network.

                // 5. Reset UI & Tunjuk Modal
                loadingSpinner.style.display = "none";
                btnText.innerText = "HANTAR DATA";
                btnHantar.disabled = false;
                btnHantar.classList.remove('opacity-75', 'cursor-not-allowed');
                
                modal.classList.remove('hidden');
                
                // 6. Reset Borang
                form.reset();
                updateFileName(document.getElementById('fileAkaun'), 'fileName'); 
                updateFileName(document.getElementById('fileAkaunSurau'), 'fileNameSurau'); 

            } catch (error) {
                console.error('Error!', error.message);
                alert("Maaf, terdapat masalah teknikal. Sila cuba lagi.");
                
                loadingSpinner.style.display = "none";
                btnText.innerText = "CUBA LAGI";
                btnHantar.disabled = false;
                btnHantar.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        });

        // Tutup Modal
        okBtn.addEventListener('click', function() {
            modal.classList.add('hidden');
        });

        // Tutup modal jika klik di luar kotak
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.classList.add('hidden');
            }
        }
    </script>
</body>
</html>